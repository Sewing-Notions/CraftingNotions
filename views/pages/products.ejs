<%- partial('../partials/header') %>
<%- partial('../partials/navbar') %>
<h1>Fabric Products with Big Patterns</h1>
<div class="product-container" id="product-list">
    <!-- Products will be displayed here -->
</div>

<script>
    async function fetchFabricProducts() {
    const query = "fabric with large patterns buy"; // More specific query
    const cx = "62a15e9ea88404e90";  // Your Google CSE ID (cx value)
    const apiKey = "AIzaSyAMYEmsZQZa4lSuz90XhfIERGVoSRQ50n0";  // Your Google API Key

    // URL to fetch products via Google Custom Search JSON API
    const apiUrl = `https://www.googleapis.com/customsearch/v1?q=${query}&cx=${cx}&key=${apiKey}`;

    try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.items && data.items.length > 0) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';  // Clear any previous results

            data.items.forEach(item => {
                // Filter results that have an image and a valid link
                const productImage = item.pagemap?.cse_image?.[0]?.src || null;
                const productUrl = item.link;

                // Only proceed if we have an image and a valid link
                if (productImage && productUrl) {
                    const productPrice = item.pagemap?.price ? `$${item.pagemap.price[0]}` : 'Price not available';

                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');

                    productCard.innerHTML = `
                        <img src="${productImage}" alt="${item.title}">
                        <h3>${item.title}</h3>
                        <p class="price">${productPrice}</p>
                        <a href="${productUrl}" target="_blank">View Product</a>
                    `;

                    productList.appendChild(productCard);
                }
            });
        } else {
            alert("No results found for your query.");
        }
    } catch (error) {
        console.error('Error fetching fabric products:', error);
    }
}

// Call the function to fetch and display products when the page loads
window.onload = fetchFabricProducts;
</script>